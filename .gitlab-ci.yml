stages:
  - package
  - publish
 
package:jessie: &package
  stage: package
  tags:
    - shell
  variables:
    DISTRO: jessie
  script:
    - git checkout master
    - export VERSION=$(git tag --contains master --merged master)
    - git archive -v --format tgz -o ../ruby-linux-netlink_$VERSION.orig.tar.gz master
    - git checkout debian/$DISTRO
    - sautobuild -d $DISTRO $PWD
  artifacts:
    paths:
      - pkg/

package:stretch:
  <<: *package
  variables:
    DISTRO: stretch

package:wheezy:
  <<: *package
  variables:
    DISTRO: wheezy

publish:
  stage: publish
  tags: 
    - shell
  script:
    - publish

